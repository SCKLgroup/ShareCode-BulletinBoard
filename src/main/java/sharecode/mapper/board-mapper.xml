<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="board">
	<select id="boardAll" resultType="sharecode.vo.PostVO">
		SELECT post_no, u.user_no, u.user_id, post_title, post_content,
		post_category, post_date, post_hit
		FROM POST p, USERINFO
		WHERE p.user_no = u.user_no and user_id=#{user_id}and
		<include refid="search"></include>
		ORDER BY post_no DESC ,post_date DESC
	</select>

	<select id="countArticle" resultType="int">
		SELECT COUNT(*) FROM POST WHERE p.user_no = u.user_no and
		user_id=#{user_id}and
		<include refid="search"></include>
	</select>

	<sql id="search">
		<choose>
			<when test="searchOption == 'all'">
				(post_content
				like '%'||#{keyword}||'%' or post_title like '%'||#{keyword}||'%')

			</when>
			<when test="searchOption == 'Java'">
				(user_id like '%'||#{keyword}||'%' or post_content like '%'||#{keyword}||'%'
				or post_title like '%'||#{keyword}||'%') and post_category = 'Java'
			</when>
			<when test="searchOption == 'Python'">
				(user_id like '%'||#{keyword}||'%' or post_content
				like '%'||#{keyword}||'%' or post_title like '%'||#{keyword}||'%')
				and post_category = 'Python'
			</when>
			<when test="searchOption == 'C++'">
				(user_id like '%'||#{keyword}||'%' or post_content
				like '%'||#{keyword}||'%' or post_title like '%'||#{keyword}||'%')
				and post_category = 'C++'
			</when>
			<when test="searchOption == 'Other'">
				(user_id like '%'||#{keyword}||'%' or post_content like '%'||#{keyword}||'%'
				or post_title like '%'||#{keyword}||'%') and post_category = 'Other'
			</when>

			<!-- <otherwise> where ${searchOption} like '%'||#{keyword}||'%' </otherwise> -->
		</choose>
	</sql>
</mapper>